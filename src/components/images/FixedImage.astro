---
/**
 * FixedImage - FIXED pattern for logos, avatars, icons
 * Use: Small fixed-size images that don't scale with viewport
 * Pattern: 1x + 2x density srcset using getImage()
 *
 * Note: For very small icons (< 24px), consider inline SVG instead
 */
import { getImage } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  src: ImageMetadata;
  alt: string;
  width: number;
  height?: number;
  class?: string;
}

const { src, alt, width, height, class: className } = Astro.props;

// FIXED pattern: 1x at quality 80, 2x at quality 60
// WebP with JPEG fallback
const image1xWebp = await getImage({
  src,
  width,
  height,
  quality: 80,
  format: 'webp'
});

const image2xWebp = await getImage({
  src,
  width: width * 2,
  height: height ? height * 2 : undefined,
  quality: 60,
  format: 'webp'
});

const image1xJpeg = await getImage({
  src,
  width,
  height,
  quality: 80,
  format: 'jpeg'
});

const finalHeight = height || width;
---

<picture>
  <source
    srcset={`${image1xWebp.src} 1x, ${image2xWebp.src} 2x`}
    type="image/webp"
  />
  <img
    src={image1xJpeg.src}
    alt={alt}
    width={width}
    height={finalHeight}
    class={className}
    loading="lazy"
    decoding="async"
  />
</picture>
